# 模型训练表现总结

## 一、TerraTNT 三阶段训练记录

### FAS1 阶段训练（域内目标 + 完备候选集）

**数据集规模**：2,183 个轨迹文件，78,477 个样本

| Epoch | 训练损失 | 训练ADE (m) | 验证损失 | 验证ADE (m) |
|:---:|:---:|:---:|:---:|:---:|
| 1 | 14,624,107,060,288 | 5,408,013 | 14,319,728,402,649 | 5,351,500 |
| 5 | 9,306,987,758,169 | 4,311,420 | 8,384,945,245,015 | 4,094,789 |
| 10 | 1,250,539,052,814 | 1,531,720 | 743,743,969,309 | 1,212,306 |
| 13 | 118,673,761,070 | 381,427 | 15,782,204,157 | 67,894 |
| 14 | 116,942,120,995 | 380,026 | 15,640,441,391 | 66,559 |
| **22** | **116,820,111,932** | **379,897** | **15,570,344,391** ✅ | **66,132** |
| 27 | 116,860,511,878 | 380,026 | 15,639,737,909 | 66,902 |

**最佳验证损失**: 15,570,344,390.65 (Epoch 22)  
**最佳验证ADE**: 66,132 米

---

### FAS2 阶段训练（域外目标 + 完备候选集）

**数据集规模**：944 个轨迹文件，32,757 个样本

| Epoch | 训练损失 | 训练ADE (m) | 验证损失 | 验证ADE (m) |
|:---:|:---:|:---:|:---:|:---:|
| 1 | 14,772,579,437,977 | 5,435,466 | 14,712,116,860,938 | 5,424,334 |
| 5 | 13,313,306,303,562 | 5,159,870 | 13,039,269,809,437 | 5,106,622 |
| 10 | 9,951,886,774,737 | 4,460,206 | 9,562,577,270,434 | 4,373,010 |
| 15 | 5,941,854,148,786 | 3,442,259 | 5,534,355,609,290 | 3,326,190 |
| 20 | 2,399,980,872,990 | 2,171,287 | 2,077,558,640,061 | 2,035,439 |
| 25 | 410,938,525,188 | 814,898 | 247,251,004,901 | 686,789 |
| 28 | 122,814,722,143 | 384,326 | 23,969,089,116 | 141,089 |
| 29 | 111,268,270,285 | 368,647 | 17,186,671,181 | 78,623 |
| **30** | **109,514,942,997** | **367,363** | **16,007,792,895** ✅ | **65,549** |

**最佳验证损失**: 16,007,792,894.75 (Epoch 30)  
**最佳验证ADE**: 65,549 米

---

### FAS3 阶段训练（域内目标 + 不完备候选集）

**数据集规模**：2,183 个轨迹文件，78,477 个样本

| Epoch | 训练损失 | 训练ADE (m) | 验证损失 | 验证ADE (m) |
|:---:|:---:|:---:|:---:|:---:|
| 1 | 14,632,807,985,741 | 5,409,631 | 14,346,397,107,277 | 5,356,480 |
| 5 | 9,566,497,124,657 | 4,371,425 | 8,680,824,442,121 | 4,166,426 |
| 10 | 1,355,932,527,069 | 1,596,012 | 823,155,820,823 | 1,276,696 |
| 15 | 116,901,398,681 | 380,042 | 15,619,054,498 ✅ | 66,549 |
| 20 | 116,822,413,254 | 379,998 | 15,705,528,226 | 67,292 |
| 25 | 116,795,741,747 | 379,936 | 15,720,943,318 | 67,563 |
| **30** | **122,751,363,300** | **391,437** | **15,619,054,498** | **66,549** |

**最佳验证损失**: 15,619,054,498.15 (Epoch 15)  
**最佳验证ADE**: 66,549 米

---

## 二、训练过程分析

### 1. 损失下降趋势

**FAS1 阶段**：
- 初始损失：~14万亿
- 最终损失：~156亿（下降了99.9%）
- 收敛速度：在Epoch 13快速收敛，之后趋于稳定

**FAS2 阶段**：
- 初始损失：~14万亿
- 最终损失：~160亿（下降了99.9%）
- 收敛速度：持续下降到Epoch 30，收敛最好

**FAS3 阶段**：
- 初始损失：~14万亿
- 最终损失：~156亿（下降了99.9%）
- 收敛速度：在Epoch 15快速收敛

### 2. ADE 指标分析

**训练集 ADE**：
- 所有阶段最终都收敛到 ~370,000-390,000 米
- 这个数值异常高（370公里），表明模型在训练集上也没有很好地拟合

**验证集 ADE**：
- FAS1: 66,132 米
- FAS2: 65,549 米（最好）
- FAS3: 66,549 米

验证集ADE相对较好（~66公里），但仍然远高于预期（应该在几百米到几公里范围内）。

### 3. 关键问题

#### ⚠️ 训练损失异常高

训练损失值高达数千亿，这表明：
1. **损失函数计算问题**：可能没有进行适当的归一化
2. **坐标系统问题**：UTM坐标值很大（数十万米），直接计算MSE会导致损失爆炸
3. **缺少归一化**：输入输出坐标没有归一化到合理范围

#### ⚠️ ADE 指标异常

- 训练ADE: ~380公里
- 验证ADE: ~66公里
- 测试ADE: ~76公里（评估结果）

这些数值远超合理范围，可能原因：
1. **坐标未归一化**：直接使用UTM坐标（数值范围0-1,000,000米）
2. **缺少环境地图**：评估时使用全零地图，模型无法利用环境特征
3. **输出格式问题**：模型输出可能需要后处理转换

---

## 三、基线模型训练表现

### Social-LSTM
- **训练时间**：1月8日 17:31 - 18:20 (~49分钟)
- **模型大小**：7.6 MB
- **测试ADE**：~9,940 米
- **测试FDE**：~20,371 米

### YNet
- **训练时间**：1月8日 18:15 - 20:38 (~2小时23分钟)
- **模型大小**：26 MB
- **状态**：模型文件未找到（可能训练失败或路径错误）

### PECNet
- **训练时间**：1月8日 18:15 - 18:24 (~9分钟)
- **模型大小**：1.3 MB
- **测试ADE**：~7,866 米
- **测试FDE**：~7,147 米

### Trajectron++
- **训练时间**：1月8日 18:58 - 21:43 (~2小时45分钟)
- **模型大小**：18 MB
- **测试ADE**：~4,831 米 ✅ **最佳**
- **测试FDE**：~9,565 米

---

## 四、评估结果对比

### FAS1 阶段（域内目标 + 完备候选集）

| 模型 | ADE (m) | FDE (m) | MR | 排名 |
|:---|:---:|:---:|:---:|:---:|
| **Trajectron++** | 4,831 | 9,565 | 1.00 | 🥇 |
| **PECNet** | 7,866 | 7,147 | 1.00 | 🥈 |
| **Social-LSTM** | 9,940 | 20,371 | 1.00 | 🥉 |
| **TerraTNT** | 76,206 | 50,746 | 1.00 | ❌ |

### FAS2 阶段（域外目标 + 完备候选集）

| 模型 | ADE (m) | FDE (m) | MR | 排名 |
|:---|:---:|:---:|:---:|:---:|
| **Trajectron++** | 4,739 | 9,294 | 1.00 | 🥇 |
| **PECNet** | 7,762 | 7,038 | 1.00 | 🥈 |
| **Social-LSTM** | 9,951 | 20,455 | 1.00 | 🥉 |
| **TerraTNT** | 77,817 | 51,696 | 1.00 | ❌ |

### FAS3 阶段（域内目标 + 不完备候选集）

| 模型 | ADE (m) | FDE (m) | MR | 排名 |
|:---|:---:|:---:|:---:|:---:|
| **Trajectron++** | 4,831 | 9,565 | 1.00 | 🥇 |
| **PECNet** | 7,866 | 7,147 | 1.00 | 🥈 |
| **Social-LSTM** | 9,940 | 20,371 | 1.00 | 🥉 |
| **TerraTNT** | 76,481 | 50,999 | 1.00 | ❌ |

---

## 五、结论与建议

### 1. 训练成功的模型

✅ **Trajectron++** - 性能最佳，ADE ~4.8公里  
✅ **PECNet** - 性能良好，ADE ~7.8公里  
✅ **Social-LSTM** - 性能可用，ADE ~9.9公里  

### 2. TerraTNT 存在的问题

❌ **训练损失异常高**（数千亿级别）  
❌ **ADE指标异常**（训练380公里，测试76公里）  
❌ **所有样本失败率100%**（MR=1.0）  

### 3. 需要修复的问题

1. **坐标归一化**
   - 输入坐标需要归一化到 [-1, 1] 或 [0, 1] 范围
   - 输出需要反归一化回UTM坐标系统

2. **损失函数**
   - 当前MSE损失对大坐标值敏感
   - 建议使用归一化坐标计算损失

3. **环境地图**
   - 评估时需要加载真实的GIS环境地图
   - 不能使用全零虚拟地图

4. **模型架构验证**
   - 检查CNN环境编码器是否正常工作
   - 验证LSTM历史编码器的输出

### 4. 下一步工作

1. **修复坐标归一化问题**
2. **重新训练TerraTNT模型**
3. **使用真实环境地图进行评估**
4. **验证模型输出的数值范围**
5. **对比论文预期结果**

---

## 六、训练时间统计

| 模型 | 阶段 | 开始时间 | 结束时间 | 耗时 |
|:---|:---|:---|:---|:---|
| Social-LSTM | - | 17:31 | 18:20 | 49分钟 |
| PECNet | - | 18:15 | 18:24 | 9分钟 |
| Trajectron++ | - | 18:58 | 21:43 | 2小时45分钟 |
| YNet | - | 18:15 | 20:38 | 2小时23分钟 |
| TerraTNT | FAS1 | 22:11 | 23:31 | 1小时20分钟 |
| TerraTNT | FAS2 | 23:48 | 00:29 | 41分钟 |
| TerraTNT | FAS3 | 00:29 | 02:09 | 1小时40分钟 |

**总训练时长**：约 9 小时
