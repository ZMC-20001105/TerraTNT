# TerraTNT 系统功能设计与交互逻辑 (UX/UI Design)

## 1. 设计理念：从“杂乱工具箱”到“标准化预测流水线”
目前的 UI 存在功能堆砌的问题。我们将系统重新定义为一个**全生命周期的轨迹预测工作站**，按照“数据 -> 模型 -> 实验 -> 部署”的逻辑线性组织功能。

---

## 2. 核心功能模块划分

### 🛰️ 模块 A：环境工作站 (Environment Station)
*用户在这里定义和查看预测的背景约束。*
*   **A1. 地图编辑器 (Map Viewer/Editor)**：多层图层管理（DEM, LULC, Roads），支持区域切换和坐标查询。
*   **A2. 代价图分析 (Cost Analysis)**：可视化不同车辆类型和战术意图下的通行成本。
*   **A3. 实时查询**：点击地图上的点，显示坡度、地表覆盖类型和该点的通行系数。

### 📊 模块 B：数据集工厂 (Dataset Factory)
*将原始数据转化为深度学习可用的张量。*
*   **B1. 生成任务管理器 (Task Manager)**：管理 Scottish, Bohemian 等区域的并行生成任务，显示进度、耗时和预计完成时间。
*   **B2. 数据质量分析 (Quality QA)**：自动检测并删除异常轨迹（如穿墙、轨迹跳变），显示轨迹长度分布、速度分布。
*   **B3. 预处理器配置**：18通道地图的标准化参数、采样率设置。

### 🧠 模块 C：模型实验室 (Model Lab)
*模型开发与参数调优的核心区域。*
*   **C1. 模型仓库 (Model Zoo)**：TerraTNT (Ours) 以及集成的 YNet, PECNet, Trajectron++ 基线模型。
*   **C2. 训练面板 (Training Dashboard)**：实时绘制损失曲线、ADE/FDE 趋势图、显存消耗监控。
*   **C3. 超参中心 (Hyperparameter Hub)**：配置文件编辑、学习率调度器可视化。

### 🎯 模块 D：智能预测中心 (Inference Center)
*系统最具交互性的部分。*
*   **D1. 交互式预测 (Manual Mode)**：
    -   用户在地图上点选历史轨迹点。
    -   系统实时生成预测轨迹（对比多模型结果）。
    -   显示预测概率热力图（Goal Heatmap）。
*   **D2. 批量推理 (Batch Mode)**：上传测试集，生成批量预测报告。

### 📈 模块 E：实验评估看板 (Analytics Dashboard)
*学术化结果展示。*
*   **E1. 对比分析表**：全模型、全区域的 ADE/FDE 性能矩阵。
*   **E2. 典型案例库 (Case Study)**：自动挑选“最佳预测”和“最差预测”案例，分析环境约束对失败案例的影响。

---

## 3. 系统交互逻辑 (Interaction Flow)

### 流程示例：从零开始一次预测实验
1.  **准备环境**：进入 `Environment Station`，确认目标区域的地形和道路数据已就绪。
2.  **数据生产**：在 `Dataset Factory` 启动 Scottish Highlands 的生成任务，监控进度。
3.  **模型训练**：
    -   在 `Model Lab` 选择 TerraTNT 和 YNet。
    -   点击 "Start Training"，通过 TensorBoard 集成监控收敛情况。
4.  **实时测试**：
    -   进入 `Inference Center`。
    -   在地图上拖动鼠标画出一段历史轨迹。
    -   界面右侧实时刷新多模型的预测结果对比（重叠在地图上）。
5.  **结果产出**：在 `Analytics Dashboard` 一键生成符合论文格式的 LaTeX 表格和对比图。

---

## 4. 交互界面改进 (UI Layout Refinement)

### 布局方案：三栏式布局
-   **左侧导航 (Slim Sidebar)**：图标化一级功能切换。
-   **中间主面板 (Main Stage)**：可视化核心（地图或大图表）。
-   **右侧控制台 (Side Console)**：上下文相关的参数调整、实时指标显示。

### 视觉反馈改进
-   **状态指示灯**：生成进程、训练进程使用呼吸灯或脉动圆点。
-   **实时日志流**：底部提供可折叠的控制台，显示 Python 运行时日志。
-   **引导式 UI**：首次使用时，通过蒙版引导用户完成“数据-训练-预测”的路径。
