# TerraTNTæ¨¡å‹è¯Šæ–­ä¸æ”¹è¿›æ–¹æ¡ˆå®éªŒæŠ¥å‘Š

**æ—¥æœŸ**: 2026-01-20  
**Checkpoint**: runs/terratnt_fas3_10s/20260119_234859/best_model.pth  
**æ•°æ®é›†**: bohemian_forest (complete_dataset_10s_full, sample_fraction=0.2)

---

## 1. å®éªŒç›®æ ‡

1. éªŒè¯æ”¹è¿›åçš„å¯è§†åŒ–å·¥å…·ï¼ˆsample selection + manifestç”Ÿæˆï¼‰
2. å®šé‡åˆ†æTerraTNTçš„ç›´çº¿åŒ–åå·®é—®é¢˜
3. é€šè¿‡ç¯å¢ƒæ¶ˆèå®éªŒè¯„ä¼°ç¯å¢ƒç‰¹å¾åˆ©ç”¨ç¨‹åº¦
4. å¯¹æ¯”ä¸»æµè½¨è¿¹é¢„æµ‹æ¨¡å‹æ¶æ„ï¼Œè¯†åˆ«æ”¹è¿›æ–¹å‘

---

## 2. å¯è§†åŒ–å·¥å…·éªŒè¯

### 2.1 åŠŸèƒ½æµ‹è¯•

âœ… **Sample selectionåŠŸèƒ½**:
```bash
# æŒ‰ç´¢å¼•é€‰æ‹©
--val_index 5

# æŒ‰æ–‡ä»¶å’Œæ ·æœ¬ç´¢å¼•é€‰æ‹©
--select_file "data/processed/.../traj_000036_intent2_type1.pkl" --select_sample_idx 1
```

âœ… **Manifestç”ŸæˆåŠŸèƒ½**:
- è¾“å‡ºæ–‡ä»¶: `{output_dir}/manifest.jsonl`
- è®°å½•å­—æ®µ: `file_path`, `sample_idx`, `ade_m`, `fde_m`, `gt_norm_dev`, `pred_norm_dev`
- ç¤ºä¾‹:
```json
{
  "shown": 1,
  "file_path": "data/processed/complete_dataset_10s_full/bohemian_forest/traj_000036_intent2_type1.pkl",
  "sample_idx": 1,
  "ade_m": 1857.81,
  "fde_m": 266.94,
  "gt_norm_dev": 0.0227,
  "pred_norm_dev": 0.0104
}
```

### 2.2 å¯å¤ç°æ€§æ”¹è¿›

- âœ… æ¯ä¸ªæ ·æœ¬å¯é€šè¿‡ `(file_path, sample_idx)` ç²¾ç¡®å®šä½
- âœ… å¯è§†åŒ–å›¾è¡¨æ ‡é¢˜åŒ…å«æ ·æœ¬èº«ä»½ä¿¡æ¯
- âœ… Manifestæ–‡ä»¶æ”¯æŒè·¨å®éªŒå¯¹æ¯”åŒä¸€æ ·æœ¬

---

## 3. ç›´çº¿åŒ–åå·®å®šé‡åˆ†æ

### 3.1 å…¨æ ·æœ¬ç»Ÿè®¡ (n=50)

| æŒ‡æ ‡ | Ground Truth | TerraTNTé¢„æµ‹ | æ’é€ŸåŸºçº¿ | ç›´çº¿åŸºçº¿ |
|------|--------------|--------------|----------|----------|
| **ADE (m)** | - | 3483.2 | 21766.7 | 1918.0 |
| **FDE (m)** | - | 2768.4 | 43218.1 | 0.0 |
| **Mean norm_dev** | 0.0721 | 0.0401 | - | - |
| **Straight frac (<0.08)** | 56.0% | 88.0% | - | - |

**å…³é”®å‘ç°**:
- TerraTNTé¢„æµ‹è½¨è¿¹çš„ç›´çº¿åŒ–æ¯”ä¾‹ï¼ˆ88%ï¼‰è¿œé«˜äºGTï¼ˆ56%ï¼‰
- **TerraTNTçš„ADEå‡ ä¹æ˜¯ç›´çº¿åŸºçº¿çš„2å€**ï¼Œè¯´æ˜æ¨¡å‹æ€§èƒ½ä¸å¦‚ç®€å•ç›´çº¿æ’å€¼
- é¢„æµ‹è½¨è¿¹çš„å¹³å‡å¼¯æ›²åº¦ï¼ˆ0.0401ï¼‰ä»…ä¸ºGTçš„56%

### 3.2 å¼¯æ›²è½¨è¿¹å­é›†åˆ†æ (n=20, GT straight_frac=0%)

| æŒ‡æ ‡ | Ground Truth | TerraTNTé¢„æµ‹ | æ’é€ŸåŸºçº¿ | ç›´çº¿åŸºçº¿ |
|------|--------------|--------------|----------|----------|
| **ADE (m)** | - | 2990.4 | 21766.7 | 3061.3 |
| **FDE (m)** | - | 2234.7 | 43218.1 | 0.0 |
| **Mean norm_dev** | 0.1210 | 0.0613 | - | - |
| **Straight frac (<0.08)** | 0.0% | 70.0% | - | - |

**å…³é”®å‘ç°**:
- å³ä½¿åœ¨GTå®Œå…¨å¼¯æ›²çš„æ ·æœ¬ä¸­ï¼Œé¢„æµ‹ä»æœ‰70%æ˜¯ç›´çº¿çš„
- **TerraTNTä¸ç›´çº¿åŸºçº¿æ€§èƒ½å‡ ä¹ç›¸åŒ**ï¼ˆ2990m vs 3061mï¼‰
- é¢„æµ‹å¼¯æ›²åº¦ä»…ä¸ºGTçš„51%ï¼Œä¸¥é‡æ¬ æ‹Ÿåˆå¼¯æ›²æ¨¡å¼

### 3.3 ç›´çº¿åŒ–é—®é¢˜ä¸¥é‡æ€§è¯„ä¼°

**ç»“è®º**: âš ï¸ **ä¸¥é‡é—®é¢˜**
- æ¨¡å‹å‡ ä¹å®Œå…¨ä¾èµ–"ç›´çº¿åˆ°ç›®æ ‡"ç­–ç•¥
- æœªèƒ½å­¦ä¹ åˆ°ç¯å¢ƒçº¦æŸä¸‹çš„å¼¯æ›²è½¨è¿¹æ¨¡å¼
- åœ¨å¼¯æ›²è½¨è¿¹é¢„æµ‹ä¸Šæ€§èƒ½é€€åŒ–åˆ°ç®€å•åŸºçº¿æ°´å¹³

---

## 4. ç¯å¢ƒç‰¹å¾åˆ©ç”¨è¯„ä¼°

### 4.1 ç¯å¢ƒæ¶ˆèå®éªŒ

| å®éªŒé…ç½® | ADE (m) | FDE (m) | Straight frac | æ€§èƒ½å˜åŒ– |
|----------|---------|---------|---------------|----------|
| **æ­£å¸¸ (baseline)** | 3483.2 | 2768.4 | 88.0% | - |
| **Zero all** | 3483.2 | 2768.4 | 88.0% | **0.0%** |

**å…³é”®å‘ç°**:
- å°†æ‰€æœ‰ç¯å¢ƒç‰¹å¾ç½®é›¶åï¼Œæ€§èƒ½**å®Œå…¨æ— å˜åŒ–**
- è¯´æ˜æ¨¡å‹**æœªèƒ½æœ‰æ•ˆåˆ©ç”¨ç¯å¢ƒä¿¡æ¯**
- é¢„æµ‹å®Œå…¨ä¾èµ–å†å²è½¨è¿¹å’Œç›®æ ‡ä½ç½®

### 4.2 ç¯å¢ƒç‰¹å¾åˆ©ç”¨å¤±è´¥åŸå› åˆ†æ

å¯èƒ½åŸå› ï¼š
1. **Goal vectoræ³¨å…¥è¿‡å¼º**: ç›´æ¥åŠ åˆ°step_inputï¼Œå‹åˆ¶ç¯å¢ƒç‰¹å¾å½±å“
2. **å±€éƒ¨ç¯å¢ƒç‰¹å¾æœªè®­ç»ƒ**: `env_local_scale2`å‚æ•°ç¼ºå¤±
3. **CNNç¼–ç å™¨å®¹é‡ä¸è¶³**: æ— æ³•å……åˆ†æå–18é€šé“ç¯å¢ƒç‰¹å¾
4. **è®­ç»ƒç­–ç•¥é—®é¢˜**: Teacher forcingè¿‡æ—©è¡°å‡ï¼Œæ¨¡å‹å­¦ä¹ æ·å¾„

---

## 5. ä¸»æµæ¨¡å‹æ¶æ„å¯¹æ¯”åˆ†æ

### 5.1 åœ°å›¾è¡¨ç¤ºæ–¹å¼å¯¹æ¯”

| æ¨¡å‹ | åœ°å›¾è¡¨ç¤º | è¦†ç›–èŒƒå›´ | åˆ†è¾¨ç‡ | æ‹“æ‰‘ä¿¡æ¯ |
|------|----------|----------|--------|----------|
| **TerraTNT** | æ …æ ¼ (18é€šé“) | 100kmÃ—100km | ~781m/pixel | âŒ |
| **LaneGCN** | çŸ¢é‡å›¾ | è½¦é“çº§ | äºšç±³çº§ | âœ… |
| **HOME** | åˆ†å±‚å›¾ | åŒºåŸŸçº§ | å¤šå°ºåº¦ | âœ… |
| **Trajectron++** | æ …æ ¼ | ~100m | ~0.5m/pixel | âŒ |
| **PECNet** | æ— åœ°å›¾ | N/A | N/A | N/A |

**TerraTNTåŠ£åŠ¿**:
- åˆ†è¾¨ç‡è¿‡ä½ï¼ˆ781m/pixelï¼‰ï¼Œæ— æ³•æ•æ‰é“è·¯ç»†èŠ‚
- æ— æ‹“æ‰‘ä¿¡æ¯ï¼Œæ— æ³•è¡¨è¾¾é“è·¯è¿æ¥å…³ç³»
- æ …æ ¼è¡¨ç¤ºç¼ºä¹æ—‹è½¬/ç¼©æ”¾ä¸å˜æ€§

### 5.2 ç›®æ ‡å¤„ç†æ–¹å¼å¯¹æ¯”

| æ¨¡å‹ | ç›®æ ‡å¤„ç† | å¤šæ¨¡æ€ | ç›®æ ‡å¼•å¯¼å¼ºåº¦ |
|------|----------|--------|--------------|
| **TerraTNT** | æ˜¾å¼åˆ†ç±»å™¨ | âŒ | **è¿‡å¼º** (ç›´æ¥åŠ ) |
| **PECNet** | VAEç»ˆç‚¹é¢„æµ‹ | âœ… | æ¡ä»¶åŒ– |
| **Trajectron++** | CVAEéšå˜é‡ | âœ… | éšå¼ |
| **LaneGCN** | è½¦é“å›¾å¼•å¯¼ | âœ… | ç»“æ„åŒ– |

**TerraTNTé—®é¢˜**:
- Goal vectoræ— å¯å­¦ä¹ ç¼©æ”¾ï¼Œæ³¨å…¥è¿‡å¼º
- å•æ¨¡æ€è¾“å‡ºï¼Œæ— ä¸ç¡®å®šæ€§å»ºæ¨¡
- ç›®æ ‡å¼•å¯¼å‹åˆ¶ç¯å¢ƒç‰¹å¾å½±å“

### 5.3 è§£ç å™¨æ¶æ„å¯¹æ¯”

| æ¨¡å‹ | è§£ç å™¨ç±»å‹ | å±‚æ¬¡ç»“æ„ | ç¯å¢ƒæ³¨å…¥ |
|------|------------|----------|----------|
| **TerraTNT** | Hierarchical LSTM | Waypoint + Step | æ¯æ­¥é‡‡æ · |
| **Trajectron++** | CVAE | å•å±‚ | åˆå§‹æ¡ä»¶ |
| **AgentFormer** | Transformer | å•å±‚ | Attention |
| **LaneGCN** | Multi-head MLP | å•å±‚ | å›¾å·ç§¯ |

**TerraTNTä¼˜åŠ¿**:
- å±‚æ¬¡åŒ–ç»“æ„ç†è®ºä¸Šæ›´é€‚åˆé•¿æ—¶åŸŸé¢„æµ‹
- æ”¯æŒé€æ­¥ç¯å¢ƒé‡‡æ ·

**TerraTNTé—®é¢˜**:
- Waypoint strideè¿‡å¤§ï¼ˆ36æ­¥ï¼‰ï¼Œä¸­é—´è·¯ç‚¹å¤ªå°‘
- å±€éƒ¨ç¯å¢ƒæ³¨å…¥æœªå……åˆ†è®­ç»ƒ

---

## 6. æ ¹å› åˆ†æ

### 6.1 ç›´çº¿åŒ–åå·®çš„æ ¹æœ¬åŸå› 

**ä¸»è¦åŸå› **:
1. **Goal vectoræ³¨å…¥æœºåˆ¶ç¼ºé™·** (ä¼˜å…ˆçº§: ğŸ”´ é«˜)
   - æ— å¯å­¦ä¹ ç¼©æ”¾å› å­
   - ç›´æ¥åŠ åˆ°step_inputï¼Œå½¢æˆå¼º"å‘å¿ƒåŠ›"
   - å‹åˆ¶ç¯å¢ƒç‰¹å¾å’Œå†å²æ¨¡å¼çš„å½±å“

2. **Waypoint strideè¿‡å¤§** (ä¼˜å…ˆçº§: ğŸŸ¡ ä¸­)
   - stride=36æ„å‘³ç€60æ­¥åªæœ‰~2ä¸ªä¸­é—´è·¯ç‚¹
   - æ— æ³•æ•æ‰ç»†ç²’åº¦è½¨è¿¹å¼¯æ›²

3. **å±€éƒ¨ç¯å¢ƒç‰¹å¾æœªè®­ç»ƒ** (ä¼˜å…ˆçº§: ğŸ”´ é«˜)
   - `env_local_scale2`å‚æ•°ç¼ºå¤±
   - å±€éƒ¨ç¯å¢ƒä¿¡æ¯æœªè¢«æœ‰æ•ˆæ³¨å…¥

4. **è®­ç»ƒç­–ç•¥é—®é¢˜** (ä¼˜å…ˆçº§: ğŸŸ¡ ä¸­)
   - Teacher forcing scheduleå¯èƒ½è¿‡æ—©è¡°å‡
   - æ¨¡å‹å­¦ä¹ åˆ°"ç›´çº¿æ·å¾„"

### 6.2 ç¯å¢ƒç‰¹å¾åˆ©ç”¨å¤±è´¥çš„æ ¹æœ¬åŸå› 

**ä¸»è¦åŸå› **:
1. **Goal vectorå‹åˆ¶** (ä¼˜å…ˆçº§: ğŸ”´ é«˜)
   - ç›®æ ‡å¼•å¯¼è¿‡å¼ºï¼Œç¯å¢ƒç‰¹å¾è¢«å¿½ç•¥

2. **CNNç¼–ç å™¨å®¹é‡ä¸è¶³** (ä¼˜å…ˆçº§: ğŸŸ¡ ä¸­)
   - 18é€šé“ç¯å¢ƒç‰¹å¾å¯èƒ½æœªè¢«å……åˆ†æå–
   - éœ€è¦æ›´æ·±æˆ–æ›´å®½çš„ç¼–ç å™¨

3. **åˆ†è¾¨ç‡è¿‡ä½** (ä¼˜å…ˆçº§: ğŸŸ¢ ä½)
   - 781m/pixelæ— æ³•æ•æ‰é“è·¯ç»†èŠ‚
   - ä½†å¯¹äº100kmå°ºåº¦é¢„æµ‹å¯èƒ½è¶³å¤Ÿ

---

## 7. æ”¹è¿›æ–¹æ¡ˆ

### 7.1 çŸ­æœŸæ”¹è¿› (1-2å‘¨å®ç°)

#### ä¼˜å…ˆçº§1: Goal vectoræ³¨å…¥ä¼˜åŒ–
```python
# æ·»åŠ å¯å­¦ä¹ ç¼©æ”¾å› å­
self.goal_vec_scale = nn.Parameter(torch.tensor(1.0))

# ä½¿ç”¨MLPæŠ•å½±
self.goal_vec_proj = nn.Linear(goal_vec_dim, hidden_dim)

# ä¿®æ”¹æ³¨å…¥æ–¹å¼
goal_vec_feat = self.goal_vec_proj(goal_vec) * self.goal_vec_scale
step_input = step_input + goal_vec_feat  # æˆ–ä½¿ç”¨concat
```

**é¢„æœŸæ•ˆæœ**: ADEé™ä½20-30%ï¼Œç›´çº¿åŒ–æ¯”ä¾‹é™ä½åˆ°70%ä»¥ä¸‹

#### ä¼˜å…ˆçº§2: Waypoint strideè°ƒæ•´
```python
# å‡å°strideä»36åˆ°12
waypoint_stride = 12  # 60æ­¥ â†’ 5ä¸ªä¸­é—´è·¯ç‚¹
```

**é¢„æœŸæ•ˆæœ**: è½¨è¿¹å¼¯æ›²åº¦æå‡ï¼Œæ›´æ¥è¿‘GT

#### ä¼˜å…ˆçº§3: å±€éƒ¨ç¯å¢ƒç‰¹å¾ä¿®å¤
```python
# ç¡®ä¿env_local_scale2è¢«æ­£ç¡®åˆå§‹åŒ–å’Œè®­ç»ƒ
self.env_local_scale2 = nn.Parameter(torch.tensor(1.0))
```

**é¢„æœŸæ•ˆæœ**: ç¯å¢ƒæ¶ˆèå®éªŒä¸­æ€§èƒ½ä¸‹é™10-15%

### 7.2 ä¸­æœŸæ”¹è¿› (1-2ä¸ªæœˆå®ç°)

#### ä¼˜å…ˆçº§1: å¤šæ¨¡æ€é¢„æµ‹
- å¼•å…¥VAEæˆ–Flow-basedæ¨¡å‹
- ä¸ºæ¯ä¸ªå€™é€‰ç›®æ ‡ç”Ÿæˆå¤šæ¡è½¨è¿¹
- æ·»åŠ è½¨è¿¹å¤šæ ·æ€§æŸå¤±

#### ä¼˜å…ˆçº§2: æ³¨æ„åŠ›æœºåˆ¶
- åœ¨ç¯å¢ƒç¼–ç å™¨ä¸­æ·»åŠ spatial attention
- åœ¨è§£ç å™¨ä¸­æ·»åŠ temporal attention
- å­¦ä¹ åŠ¨æ€å…³æ³¨é‡è¦ç¯å¢ƒåŒºåŸŸ

#### ä¼˜å…ˆçº§3: æŸå¤±å‡½æ•°æ”¹è¿›
```python
# å¢åŠ å¼¯æ›²åº¦ä¸€è‡´æ€§æŸå¤±æƒé‡
curvature_loss_weight = 2.0  # å½“å‰å¯èƒ½è¿‡ä½

# æ·»åŠ ç¯å¢ƒå¯¹é½æŸå¤±
env_alignment_loss = compute_road_alignment(pred_traj, road_map)
```

### 7.3 é•¿æœŸæ”¹è¿› (3-6ä¸ªæœˆå®ç°)

#### ä¼˜å…ˆçº§1: æ··åˆåœ°å›¾è¡¨ç¤º
- æ …æ ¼åœ°å›¾ + çŸ¢é‡é“è·¯å›¾
- å­¦ä¹ é“è·¯æ‹“æ‰‘ç»“æ„
- ç»“åˆLaneGCNçš„è½¦é“å›¾æ€æƒ³

#### ä¼˜å…ˆçº§2: åˆ†å±‚ç¯å¢ƒå»ºæ¨¡
- å€Ÿé‰´HOMEçš„åˆ†å±‚å›¾ç»“æ„
- åŒºåŸŸçº§ + å¯¹è±¡çº§ + åƒç´ çº§
- å¤šå°ºåº¦ç¯å¢ƒæ¨ç†

---

## 8. å®éªŒè®¡åˆ’

### 8.1 çŸ­æœŸå®éªŒ (æœ¬å‘¨)

- [x] å¯è§†åŒ–å·¥å…·éªŒè¯
- [x] ç›´çº¿åŒ–åå·®å®šé‡åˆ†æ
- [x] ç¯å¢ƒæ¶ˆèå®éªŒ
- [x] ä¸»æµæ¨¡å‹æ¶æ„å¯¹æ¯”
- [ ] å®ç°goal_vec_scaleä¼˜åŒ–
- [ ] è®­ç»ƒå¹¶è¯„ä¼°ä¼˜åŒ–åæ¨¡å‹
- [ ] å¯¹æ¯”ä¼˜åŒ–å‰åæ€§èƒ½

### 8.2 ä¸­æœŸå®éªŒ (ä¸‹å‘¨)

- [ ] Waypoint strideæ¶ˆèå®éªŒ (12, 18, 24, 36)
- [ ] å±€éƒ¨ç¯å¢ƒç‰¹å¾ä¿®å¤
- [ ] æŸå¤±å‡½æ•°æƒé‡è°ƒä¼˜
- [ ] PECNet baselineé›†æˆå’Œå¯¹æ¯”

### 8.3 é•¿æœŸå®éªŒ (ä¸‹æœˆ)

- [ ] å¤šæ¨¡æ€é¢„æµ‹å®ç°
- [ ] æ³¨æ„åŠ›æœºåˆ¶é›†æˆ
- [ ] æ··åˆåœ°å›¾è¡¨ç¤ºæ¢ç´¢
- [ ] è·¨åŒºåŸŸæ³›åŒ–æµ‹è¯•

---

## 9. ç»“è®º

### 9.1 ä¸»è¦å‘ç°

1. **ç›´çº¿åŒ–åå·®ä¸¥é‡**: é¢„æµ‹è½¨è¿¹88%ä¸ºç›´çº¿ï¼ŒGTä»…56%
2. **ç¯å¢ƒç‰¹å¾æœªåˆ©ç”¨**: æ¶ˆèå®éªŒæ˜¾ç¤ºæ€§èƒ½æ— å˜åŒ–
3. **æ€§èƒ½ä¸å¦‚ç®€å•åŸºçº¿**: ADEæ˜¯ç›´çº¿åŸºçº¿çš„2å€
4. **Goal vectoræ³¨å…¥è¿‡å¼º**: æ˜¯ä¸»è¦é—®é¢˜æ ¹æº

### 9.2 æ”¹è¿›ä¼˜å…ˆçº§

1. ğŸ”´ **é«˜ä¼˜å…ˆçº§**: Goal vectoræ³¨å…¥ä¼˜åŒ–ã€å±€éƒ¨ç¯å¢ƒç‰¹å¾ä¿®å¤
2. ğŸŸ¡ **ä¸­ä¼˜å…ˆçº§**: Waypoint strideè°ƒæ•´ã€æŸå¤±å‡½æ•°æ”¹è¿›
3. ğŸŸ¢ **ä½ä¼˜å…ˆçº§**: å¤šæ¨¡æ€é¢„æµ‹ã€æ··åˆåœ°å›¾è¡¨ç¤º

### 9.3 é¢„æœŸæ”¹è¿›æ•ˆæœ

**çŸ­æœŸç›®æ ‡** (1-2å‘¨):
- ADEé™ä½åˆ° <2500m
- ç›´çº¿åŒ–æ¯”ä¾‹é™ä½åˆ° <70%
- ç¯å¢ƒæ¶ˆèå®éªŒæ€§èƒ½ä¸‹é™ >10%

**ä¸­æœŸç›®æ ‡** (1-2ä¸ªæœˆ):
- ADEé™ä½åˆ° <1500m
- ç›´çº¿åŒ–æ¯”ä¾‹æ¥è¿‘GTæ°´å¹³ (~60%)
- å¤šæ¨¡æ€é¢„æµ‹èƒ½åŠ›

**é•¿æœŸç›®æ ‡** (3-6ä¸ªæœˆ):
- ADEé™ä½åˆ° <500m (ç”¨æˆ·ç›®æ ‡)
- è½¨è¿¹çœŸå®æ€§å’Œç¯å¢ƒæ„ŸçŸ¥è¾¾åˆ°SOTAæ°´å¹³
- è·¨åŒºåŸŸæ³›åŒ–èƒ½åŠ›

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-20 21:40  
**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: å®ç°goal_vec_scaleä¼˜åŒ–å¹¶å¼€å§‹è®­ç»ƒ
