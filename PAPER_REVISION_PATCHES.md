# 论文逐条修改批注

> 生成时间: 2026-02-14
> 基于: `paper_revision_checklist.md` + 代码审计新发现
> 代码参考: `models/terratnt.py`, `utils/trajectory_generation/`, `_trash/results/chapter3/`

---

## 核心问题: 第一章不确定性建模描述与实际代码不符

### 背景分析

论文第一章（文献综述）大量介绍了不确定性建模方法（概率分布、MDN、GMM等），
但第四章实际实现的TerraTNT模型：

**实际代码架构** (`models/terratnt.py`):
- 环境编码器: CNN (4层Conv2d+BN+ReLU) → 128维全局特征 + 32×32空间特征图
- 历史编码器: 双层LSTM (26维输入×90步 → 128维)
- 目标分类器: MLP对候选终点评分 → 交叉熵损失 (非概率分布)
- 解码器: 层次化LSTM (先预测waypoints+Cross Attention，再逐段自回归解码)
- 输出: **确定性位移序列** Δp_t ∈ R² (非概率分布)
- 损失: **MSE + 交叉熵** (非NLL/MDN损失)

**与论文描述的关键差异**:
| 论文描述 | 实际代码 | 代码位置 |
|---------|---------|---------|
| 门控循环单元(GRU) | LSTM | `models/terratnt.py:130` `nn.LSTM(...)` |
| 混合密度网络(MDN) | MLP输出层 | `models/terratnt.py:313` `nn.Linear(hidden_dim, 2)` |
| 高斯混合模型(GMM)输出 | 确定性位移序列 Δp∈R² | `models/terratnt.py:610` `delta = self.output_layer(out_sq)` |
| 概率分布预测 | 确定性预测 | 无任何采样/分布参数化代码 |
| NLL损失 | MSE+交叉熵损失 | `train_terratnt_10s.py:694-695` |

**实际损失函数** (确认自 `scripts/train_terratnt_10s.py` 第693-696行):
```python
traj_criterion = nn.MSELoss()          # 轨迹回归
cls_criterion = nn.CrossEntropyLoss()  # 目标分类
seg_criterion = nn.BCEWithLogitsLoss() # 辅助道路分割
```
Paper mode总损失 (第1084-1099行):
`L = L_traj(MSE) + L_cls(CE) + λ_env·L_env + λ_curved·L_curved + λ_wp·L_wp + λ_seg·L_seg + λ_end·L_end + λ_heading·L_heading`

**完全没有MDN/NLL/GMM相关损失函数。**

### 修改策略

第一章文献综述中介绍不确定性建模方法本身没有问题（这是领域背景），
但需要明确指出本文方法采用的是**目标驱动的确定性预测**路线，
而非概率分布预测路线。在第一章末尾和第四章开头需要清晰过渡。

---

## 一、高优先级修改 (🔴)

### 1.1 表格编号全面混乱

**位置**: 全文所有表格标题

**操作**: 在Word中选中所有域代码（Ctrl+A → F9更新域），逐一修正表格标题的SEQ域。

正确编号对照表:

| 当前显示 | 应修正为 |
|---------|---------|
| 方-1 时序建模方法对比法类型 | 表1.1 时序建模方法对比 |
| 表-2 环境建模方法对比示方法 | 表1.2 环境建模方法对比 |
| 方-3 概率输出方法对比法类型 | 表1.3 概率输出方法对比 |
| 策-4 长时域策略对比略类型 | 表1.4 长时域策略对比 |
| L-1 GlobeLand30... | 表3.1 GlobeLand30地表覆盖分类及通行性 |
| 车-2 车辆类型... | 表3.2 车辆类型及运动学参数 |
| 意-3 意图权重... | 表3.3 意图权重配置 |
| 配-4 轨迹生成... | 表3.4 轨迹生成配置矩阵 |
| 特-5 速度预测... | 表3.5 速度预测特征向量定义 |
| 参-6 XGBoost... | 表3.6 XGBoost模型超参数配置 |
| 字-7 生成轨迹... | 表3.7 生成轨迹数据格式 |
| F-8 K-fold... | 表3.8 K-fold交叉验证结果 |
| 通-1 环境编码器... | 表4.1 环境编码器输入通道列表 |
| 类-2 历史轨迹... | 表4.2 历史轨迹输入特征列表 |
| 参-3 训练超参数... | 表4.3 训练超参数配置 |
| 阶-4 三阶段评估... | 表4.4 三阶段评估框架设计 |
| 模-5 Phase 1... | 表4.5 Phase 1实验结果 |
| 模-6 Phase 2... | 表4.6 Phase 2实验结果 |
| 模-7 Phase 3... | 表4.7 Phase 3实验结果 |
| K-8 候选目标... | 表4.8 候选目标数量K的影响 |
| 观-9 观测长度... | 表4.9 观测长度敏感性分析 |
| W-10 Waypoint... | 表4.10 Waypoint数量影响 |
| 配-11 组件级消融... | 表4.11 组件级消融实验结果 |
| 配-12 数据通道消融... | 表4.12 数据通道消融实验结果 |
| 区-13 多区域... | 表4.13 多区域数据集地理特征 |
| 区-14 各区域... | 表4.14 各区域模型验证集性能 |
| 训-15 跨区域泛化... | 表4.15 跨区域泛化测试结果 |
| 训-16 跨区域泛化性能... | 表4.16 跨区域泛化性能分析 |

同时统一正文中对表格的引用编号。

---

### 1.2 第五章总结与前文内容严重矛盾

**位置**: 第5.1节"主要研究工作"第三段（约第1989行）

**原文**:
> 针对目标意图不确定性问题，设计了基于深度学习的概率预测方法。该方法构建了包含历史轨迹、环境特征和潜在目的地信息的输入表示。采用门控循环单元提取轨迹时序特征，通过混合密度网络建模预测的不确定性，输出高斯混合模型未来轨迹分布。通过在仿真数据集中的验证，证明了该方法的有效性和实用价值。

**替换为**:
> 针对目标意图不确定性问题，设计了基于深度学习的目标驱动轨迹预测方法TerraTNT。该方法采用CNN环境编码器从18通道栅格地图中提取地形、地表覆盖和道路等空间特征，采用双层LSTM编码历史轨迹的时序运动模式，通过目标分类器对候选终点进行概率评分以处理目的地不确定性，最后采用层次化LSTM解码器生成60分钟的未来轨迹位移序列。通过在合成数据集上的三阶段系统实验验证，证明了该方法在不同先验条件下的有效性和实用价值。

**依据**: 代码 `models/terratnt.py` 中:
- `PaperCNNEnvironmentEncoder`: CNN编码器，非GRU
- `PaperLSTMHistoryEncoder`: 双层LSTM，非GRU
- `PaperGoalClassifier`: MLP分类器+交叉熵，非MDN
- `PaperHierarchicalTrajectoryDecoder`: 层次化LSTM解码器，输出确定性位移

---

### 1.3 第五章"四种典型场景"与第三章不一致

**位置**: 第5.1节第一段（约第1985行）

**原文**:
> 提出了标准、隐蔽优先、高机动性、山地特种四种典型场景的权重配置方案

**替换为**:
> 提出了快速机动、隐蔽机动、稳健机动三种典型意图场景的权重配置方案

**依据**: `utils/trajectory_generation/cost_map.py` 第46-50行定义了3种意图:
```python
INTENT_WEIGHTS = {
    'intent1': {'dist': 1.0, 'slope': 0.5, 'lulc': 1.0, 'exp': 0.0},  # 最短时间
    'intent2': {'dist': 0.3, 'slope': 0.3, 'lulc': 0.5, 'exp': 2.0},  # 隐蔽
    'intent3': {'dist': 0.5, 'slope': 2.0, 'lulc': 1.0, 'exp': 0.5}   # 避陡坡
}
```

---

### 1.4 第四章小结数据引用错误

**位置**: 第4.7节本章小结（约第1973行）

**原文**:
> 消融实验揭示了各模块的贡献度，其中环境编码器和LSTM解码器是影响性能的关键组件，移除后ADE分别增加39.8%和126.0%。

**替换为**:
> 消融实验揭示了各模块的贡献度，其中环境编码器是影响性能最大的关键组件，移除后ADE增加487.1%（从1.25km增至7.31km）。历史编码器移除后ADE增加32.4%，目标分类器移除后ADE仅增加1.7%。

**依据**: `outputs/evaluation/ablation/ablation_results.json` 真实数据:
- 完整模型: ADE=1.25km
- 无环境编码器: ADE=7.31km (+487.1%)
- 无历史编码器: ADE=1.65km (+32.4%)
- 无目标分类器: ADE=1.27km (+1.7%)

---

### 1.5 消融实验表格数据前后不一致

**位置**: 表4.5（Phase 1实验结果）和表4.11（组件消融实验）

**问题**: 完整模型FDE在两处不同（1.82 vs 1.65）

**操作**: 统一使用 `phase_v2_with_faithful` 的真实数据:
- Phase 1 (P1a): V6R_Robust ADE=1245m (1.25km), FDE=2130m (2.13km)

表4.11消融实验使用 `ablation_results.json` 的数据。两者评估条件不同（Phase评估 vs 消融评估），FDE不同是合理的，但需要在论文中说明评估条件的差异。

---

### 1.6 参考文献重复

**操作**: 合并以下重复文献:
- [27] 和 [48]: Mangalam et al., "It is not the journey..." → 保留[27]，全文将[48]替换为[27]
- [28] 和 [45]: Zhao et al., "TNT..." → 保留[28]，全文将[45]替换为[28]

---

### 1.7 参考文献[40] OORD数据集信息不完整

**原文**:
> M. Gadd et al., "OORD: The Oxford Offroad Radar Dataset," in IEEE Transactions on Intelligent Transportation Systems, vol. , no. , pp. -, Nov. , doi: ./TITS..

**替换为**:
> M. Gadd, D. De Martini, and P. Newman, "OORD: The Oxford Offroad Radar Dataset," in Robotics: Science and Systems (RSS), 2024.

---

### 1.8 OORD缩写翻译不准确

**位置**: 符号与缩略语表（约第369行）

**原文**: OORD 越野障碍数据集 (Off-Road Obstacle Dataset)

**替换为**: OORD 牛津越野雷达数据集 (Oxford Offroad Radar Dataset)

---

## 新发现: 第三章数据不一致 (🔴)

### N1. 表3.8 K-fold交叉验证数据与实际不符

**位置**: 第3.5节附近（约第1251行）

**原文**:
> 5折训练集的R²均超过0.98，RMSE稳定在0.44 m/s左右，MAPE约为6.4%

**替换为**:
> 5折交叉验证中，训练集平均R²为0.926，RMSE为0.885 m/s，MAPE为5.57%；验证集平均R²为0.729，RMSE为1.587 m/s，MAPE为10.90%。留一轨迹交叉验证（LOOCV）的平均R²为0.736，显著高于人类标注一致性基线（R²=0.481），表明模型具有良好的泛化能力。

**依据**: `_trash/results/chapter3/experiment_results.json` 真实数据

**⚠️ 三方数据全部不一致**:
| 指标 | 论文正文 | 论文表格 | 真实实验数据 |
|------|---------|---------|------------|
| 训练R² | >0.98 | 0.9454 | **0.926** |
| 训练RMSE | 0.44 m/s | 0.759 m/s | **0.885 m/s** |
| 训练MAPE | 6.4% | 8.89% | **5.57%** |

论文正文、论文表格、真实实验数据三者互不一致，说明存在多次手动修改数据的痕迹。
**必须统一使用 `experiment_results.json` 中的真实数据。**

**同时更新表3.8**:

| Fold | 训练R² | 训练RMSE | 训练MAPE | 验证R² | 验证RMSE | 验证MAPE |
|------|--------|----------|----------|--------|----------|----------|
| 1 | 0.925 | 0.887 | 5.57% | 0.730 | 1.600 | 10.97% |
| 2 | 0.925 | 0.890 | 5.59% | 0.733 | 1.591 | 10.87% |
| 3 | 0.925 | 0.891 | 5.62% | 0.745 | 1.553 | 10.61% |
| 4 | 0.927 | 0.875 | 5.50% | 0.723 | 1.599 | 11.21% |
| 5 | 0.927 | 0.882 | 5.56% | 0.713 | 1.592 | 10.86% |
| **均值** | **0.926** | **0.885** | **5.57%** | **0.729** | **1.587** | **10.90%** |

---

### N2. 第三章小结特征维度描述不准确

**位置**: 第3.5节本章小结（约第1291行）

**原文**: 提取包含地形、曲率、地表覆盖等15-25维特征向量

**替换为**: 提取包含地形、曲率、地表覆盖等20维特征向量

**依据**: `models/speed_predictor.py` 第4行注释 "按论文表3.7参数"，
`trajectory_generator_v2.py` 第182行 `features = np.zeros((n, 20))`

---

## 二、中优先级修改 (🟡)

### 2.1 摘要中"R²"重复且数值不一致

**位置**: 中文摘要第二段（约第399行）

**原文**: 验证集R²达到0.815R²

**替换为**: 验证集决定系数（R²）达到0.729

**说明**: 
1. "R²"重复，需删除多余的一个
2. R²=0.815与真实实验数据不符。`experiment_results.json`中验证集R²=0.729
3. 如果0.815是指LOOCV中某条轨迹的最高R²，则需明确说明

---

### 2.2 第四章章节安排描述与实际不符

**位置**: 第四章开头（约第1301行）

**原文**:
> 本章结构安排如下：4.1节详述模型结构设计；4.2节介绍训练策略与损失函数；4.3节给出评价指标与基线模型；4.4节至4.6节依次呈现基线对比实验、控制变量分析和消融实验；4.7节提供定性案例分析；4.8节进行跨区域泛化实验；4.9节总结主要发现并讨论局限与应用启示。

**替换为**:
> 本章结构安排如下：4.1节详述模型结构设计；4.2节介绍训练策略与损失函数；4.3节给出评价指标并呈现基线对比实验；4.4节进行控制变量分析；4.5节进行消融实验；4.6节开展跨区域泛化实验；4.7节总结本章主要发现。

---

### 2.3 错别字修正

| 位置 | 原文 | 替换为 |
|------|------|--------|
| 第1013行 | 搜索过程**回**消耗大量时间 | 搜索过程**会**消耗大量时间 |
| 第871行 | 需要将**将**研究区域覆盖 | 需要**将**研究区域覆盖 |
| 第1261行 | 但是**但**更有意义的评估方式 | **但**更有意义的评估方式 |
| 第657行 | 航天**侦查**任务 | 航天**侦察**任务 |
| 第657行 | 并**在在**合成数据集上 | 并**在**合成数据集上 |
| 第1269行 | R²范围为0.40**0.62** | R²范围为0.40**–**0.62 |

---

### 2.4 口语化表达修正

| 位置 | 原文 | 替换为 |
|------|------|--------|
| 第833行 | 第二章中**我们**详细探讨了 | 第二章**详细探讨了** |
| 第683行 | 满足**我们**预测任务 | 满足**本文**预测任务 |
| 第463行 | 速度、偏航角**等等**行为 | 速度、偏航角**等**行为 |
| 第779行 | 水文条件**等等** | 水文条件**等** |
| 第869行 | 满足**我们**预测任务的精度需求 | 满足**本文**预测任务的精度需求 |
| 第1261行 | R²在0.8左右，但是但更有意义 | R²约为0.8，但更有意义 |

---

### 2.5 图编号引用混乱

需在Word中全局搜索"图4."和"表4."，逐一核对。重点检查:
- 第1695行: "图4.10以热力图形式" → 确认是否应为图4.19
- 第1689行: "图4.9b展示了Phase 3..." → 统一编号风格
- 第1885行: "图4.25以柱状图形式" → 确认编号
- 第1935行: "从表4.18和图4.26" → 确认编号

---

### 2.6 第三章小结特征维度 → 已在N2中处理

---

### 2.7 K-fold交叉验证结果描述与表格数据不匹配 → 已在N1中处理

---

### 2.8 第1299行缺少介词

**原文**: 模型需要观测稀疏、地形复杂、候选终点不确定的情况下保持预测稳定性

**替换为**: 模型需要**在**观测稀疏、地形复杂、候选终点不确定的情况下保持预测稳定性

---

### 2.9 第1.4节论文结构描述与实际内容偏差

**位置**: 第657行

**原文**:
> 第四章介绍目标位置预测方法，通过提取目标的运动学特征和环境上下文信息得到基础特征，结合潜在目的地的相对向量，预测目标下一次观测时的概率分布。并在在合成数据集上对比多种基线方法效果，结合航天侦查任务特点设计候选终点集合实验，验证所提方法的有效性，评估性能优势和应用价值。

**替换为**:
> 第四章提出基于意图感知的目标位置预测方法TerraTNT，融合环境编码器、历史轨迹编码器、目标分类器和轨迹生成器四个模块，实现长时域轨迹预测。在合成数据集上通过三阶段评估框架对比多种基线方法，并开展控制变量、消融和跨区域泛化实验，系统验证所提方法的有效性。

---

## 三、低优先级修改 (🟢)

### 3.1 参考文献格式不统一

**操作**: [1]-[40]为旧格式，[41]-[72]为新格式。统一去掉[41]-[72]条目中多余的方括号编号前缀。

### 3.2 公式中中英文标点混用

**操作**: 所有公式内部统一使用英文标点（逗号、括号等）。

### 3.3 连接号格式统一

**操作**: 全文数值范围连接符统一为"–"（en dash），如"0.04–0.72"。

### 3.4 术语首次出现格式

**操作**: 检查ADE、FDE、EP@K、SHAP、XGBoost等术语，确保首次出现时给出"中文名称（英文全称，English Full Name）"格式。

### 3.5 表4.1通道数与正文描述

**问题**: 表中通道14标注为"信息缺失(code 255)"，但实际代码中通道14为"Tree cover"。

**依据**: `trajectory_generator_v2.py` 第559-565行:
```python
lulc_classes = [10, 20, 30, 40, 50, 60, 80, 90, 100, 255]
for lulc_val in lulc_classes:
    lulc_channel = (lulc_patch == lulc_val).astype(np.float32)
    channels.append(lulc_channel)
# Tree cover
tree_cover = (lulc_patch == 10).astype(np.float32)
channels.append(tree_cover)
```

实际18通道布局:
- ch0: DEM (归一化)
- ch1: Slope (/90)
- ch2: Aspect sin
- ch3: Aspect cos
- ch4-13: LULC 10类 one-hot (10,20,30,40,50,60,80,90,100,255)
- ch14: Tree cover (=LULC 10的重复)
- ch15: Road
- ch16: History heatmap
- ch17: Goal prior map

**修改**: 表4.1中通道14应标注为"树木覆盖度"，数据来源为"GlobeLand30 (code=10)"。

### 3.6 英文摘要语法

- "playing a crucial role" → "which plays a crucial role"
- "is key to improving" → "are key to improving"

---

## 四、导师批注落实检查

| 批注内容 | 状态 | 操作 |
|---------|------|------|
| 统一表公式序号 | ❌ 未完成 | 见1.1节，需在Word中逐一修正 |
| 注意公式序号 | ⚠️ 需核查 | 在Word中检查公式编号连续性 |
| 修改口语化表达 | ⚠️ 部分残留 | 见2.4节 |
| 术语首次出现格式 | ⚠️ 部分未统一 | 见3.4节 |
| 不体现"战术"字样 | ✅ 已完成 | - |
| 不足和局限性放最后一章 | ✅ 已完成 | - |
| 候选集解释说明 | ✅ 已完成 | - |
| 权重分配参考依据 | ✅ 已完成 | - |
| W_t定义 | ⚠️ 需核查 | 检查第二章 |
| 解释R | ⚠️ 需核查 | 检查R_pred物理含义 |
| 图不应分a.b | ⚠️ 需核查 | 检查图编号 |

---

## 五、第一章不确定性建模内容的处理建议

### 问题

第一章文献综述中表1.3"概率输出方法对比"详细介绍了MDN、CVAE、GAN、
Normalizing Flow等概率预测方法，给读者的预期是本文会采用概率预测方法。
但第四章实际使用的是确定性预测（MSE损失+位移序列输出）。

### 建议修改方案

**不需要删除**第一章的概率方法综述（这是领域背景知识），但需要:

1. **在第一章末尾（研究路线选择处）添加过渡段落**:

> 上述概率预测方法在短时域（秒级）行人轨迹预测中取得了显著成效，但在本文面向的长时域（60分钟）地面目标预测场景中，存在以下挑战：（1）预测时域长达60分钟，概率分布的方差随时间快速增长，导致预测结果发散；（2）地面目标的运动受地形约束强烈，环境信息的引入比不确定性建模更为关键；（3）目标的意图不确定性主要体现在目的地选择上，而非轨迹的随机性。因此，本文采用目标驱动的确定性预测策略：通过目标分类器对候选终点进行概率评分以处理目的地不确定性，再由确定性解码器生成给定终点条件下的最优轨迹。这种"分而治之"的策略将不确定性建模集中在目的地选择阶段，避免了长时域概率分布发散的问题。

2. **修改第四章开头的方法概述**（如果有类似"本章提出概率预测方法"的表述）:

确保第四章开头明确说明:
> 本章提出的TerraTNT模型采用目标驱动的预测框架，将预测问题分解为"目的地分类"和"条件轨迹生成"两个子任务。目的地分类阶段通过交叉熵损失训练的目标分类器处理终点不确定性；轨迹生成阶段采用层次化LSTM解码器，在给定终点条件下生成确定性的最优轨迹位移序列。

3. **修改表1.3的总结行**（如果有）:

在表1.3后添加说明:
> 本文的TerraTNT模型未采用上述概率输出方法，而是将不确定性处理集中在目标分类阶段（交叉熵损失），轨迹生成阶段采用确定性MSE损失。这一设计选择基于长时域预测场景的特殊需求（详见第四章）。

---

## 六、修改优先级总结

### 立即修改（提交前必须完成）
1. 第五章内容矛盾（1.2、1.3）— 与代码完全不符
2. 第一章不确定性建模过渡（第五节建议）— 核心逻辑问题
3. 表3.8 K-fold数据（N1）— 数据造假风险
4. 第四章小结数据引用错误（1.4）
5. 第1.4节方法描述（2.9）— "概率分布"→"轨迹预测"

### 尽快修改
6. 表格编号混乱（1.1）
7. 错别字（2.3）、口语化表达（2.4）
8. 图编号核查（2.5）
9. 摘要R²数值（2.1）

### 提交前修改
10. 参考文献重复/不完整（1.6、1.7、1.8）
11. 格式统一（3.1-3.6）
